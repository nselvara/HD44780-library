[![Build Status](https://github.com/nselvara/HD44780-library/actions/workflows/ci.yml/badge.svg)](https://github.com/nselvara/HD44780-library/actions/workflows/ci.yml)
[![License: LGPL v3](https://img.shields.io/badge/License-LGPL%20v3-blue.svg)](https://www.gnu.org/licenses/lgpl-3.0)
[![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)](#)

# HD44780 LCD Library for Embedded Systems

A modular, cross-platform, embedded C library for controlling HD44780-compatible character LCD displays.  
Supports custom HAL backends, simulation, printf-style output, and flexible demos.

---

## Features

- 8-bit GPIO interface using simple HAL
- Lot of LCD features (cursor, clear, bar drawing, scrolling)
  - Custom `lcd_print_custom()` and standard `lcd_print_std()` versions
- 4x16 LCD simulation with terminal output
- Cursor control, special character translation
- Full unit test and demo integration
  - Testable on host system without hardware
- ANSI C (C99) and portable
- HAL-based architecture (simulation, Xilinx GPIO, mock, custom)
- CMake-based build system

---

## Build & Test Instructions

### Prerequisites

- CMake >= 3.14
- A C99-compatible compiler (GCC, Clang, etc.)
- Git (for cloning)

### Building (with CMake)

```bash
git clone https://github.com/nselvara/HD44780-library.git
cd HD44780-library
mkdir build && cd build
cmake .. -DUSE_SIMULATION=ON
make
```

### Demo Binaries

- `lcd_demo` – basic hello world
- `lcd_demo_format` – formatted output
- `lcd_demo_xilinx` – target-specific

```bash
./lcd_demo
```

You'll see simulated output like:

```terminal
----- LCD STATE -----
CPU Temp: 37.80°C
Hello, World!
                
----------------------
```

### Run Unit Tests

```bash
ctest
```

All tests run with simulated LCD buffer and assert correctness.

---

## Platform Abstraction (HAL)

To use on your own hardware:

Implement two platform-specific functions in a new file:

```c
void lcd_gpio_write(uint8_t data, uint8_t rs, uint8_t rw, uint8_t en);
void lcd_delay_ms(uint32_t ms);
```

For example, for Xilinx MicroBlaze you'd call `XGpio_DiscreteWrite()` and `usleep()`.

---

## Two `lcd_print_xy()` Implementations

```c
lcd_print_custom("Temp: %d°C", 27);  // My own implementation (it uses less resources)
lcd_print_std("Temp: %.2f°C", 27.5); // Standard via vsnprintf
```


---

## 🔧 API Overview

- `lcd_init_with_default_hal()` – Initializes the default HAL (selected by CMake)
- `lcd_init_auto_or_manual()` – Only sets HAL if one hasn’t been set
- `lcd_write`, `lcd_write_at`, `lcd_set_cursor`
- `lcd_print_custom`, `lcd_print_std` (printf-style output)
- `lcd_draw_bar`, `lcd_scroll_left/right`, etc.

---

## File Structure

```tree
📁 include/          → Public headers (lcd.h, config, features)
📁 src/              → Core implementation logic
📁 hal/              → Platform HAL implementations (mock, sim, xilinx)
📁 tests/            → Unit + simulation tests
📁 demo/             → Example programs using LCD
📁 .github/workflows → CI for build/test/release
```

---

### Using the Xilinx HAL

To build using the Xilinx GPIO interface:

```bash
cmake -B build -DUSE_XILINX_HAL=ON
cmake --build build
```

Then in your code:

```c
lcd_hal_set_backend(&LCD_HAL_XILINX_GPIO);
lcd_init();
```

Both are available and interchangeable.

## Project Structure

```tree
HD44780-library/
├── CMakeLists.txt
├── include/                # Public headers
│   └── lcd.h, lcd_hal.h, lcd_features.h, LCD_HAL_XILINX_GPIO.h
├── hal/                    # HAL implementations (sim, Xilinx, etc.)
│   └── lcd_hal_*.c
├── src/                    # Core implementation files
├── test/                   # Unit tests
├── demo/                   # Terminal simulation demo
├── docs/                   # (Generated by Doxygen)
├── .github/workflows/      # CI workflow
├── .clang-format
├── Doxyfile
└── README.md
```

## Xilinx MicroBlaze Example

To use this library in a Xilinx platform (e.g. with PLB GPIO):

```c
#include "lcd.h"
#include "LCD_HAL_XILINX_GPIO.h"

int main() {
    lcd_hal_set_backend(&LCD_HAL_XILINX_GPIO);
    lcd_init();
    lcd_write("Hello from FPGA!");
    while (1);
}
```

In Vivado SDK / Vitis:

- Link against compiled `.a` or include the source
- Set `XPAR_LCD_GPIO_DEVICE_ID` via `xparameters.h`

---

## License

This project is licensed under the **LGPL v3.0**.  
You can use this library in both open and closed-source projects, as long as you publish modifications to the library itself.

See [LICENSE](./LICENSE) for full terms.
